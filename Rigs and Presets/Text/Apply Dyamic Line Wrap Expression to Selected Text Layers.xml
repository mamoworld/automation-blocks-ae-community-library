<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="-@|Pb/jEFU.r4Z^]O0@t">max chars per line</variable><variable id="FR_=*$GQ8*6N|bA#h+uj">my layer</variable></variables><block type="mm_multiline_comment_block" id="D+~U6[j9QbE}gtJwAyb4" x="-1316" y="182"><field name="TEXT">Applies an expression to the&amp;#10;source text of the selected&amp;#10;text layers. This expression automatically &amp;#10;wraps the text in a text layer so that each &amp;#10;line is no longer than 80 characters. It&amp;#10; splits the layer’s original string into words,&amp;#10; then builds lines by adding words until the&amp;#10; next word would exceed the 80-character limit.&amp;#10; If a single word itself is longer than 80 &amp;#10;characters, it breaks that word into 80-character&amp;#10; segments. Finally, it inserts carriage returns &amp;#10;between each line, ensuring that no line ever&amp;#10; exceeds the specified maximum.</field></block><block type="variables_set" id="~v1YQD{$%1oK:CgZ9~PD" x="-871" y="229"><field name="VAR" id="-@|Pb/jEFU.r4Z^]O0@t">max chars per line</field><value name="VALUE"><block type="math_number" id="A*9AP2^/7Gr]h[7[IoN?"><field name="NUM">80</field></block></value><next><block type="modal_input_dialog" id="R92uiQLA;6GyTa#Xf,`G"><mutation items="2"></mutation><field name="OK_CANCEL">OK_CANCEL</field><field name="FIELD_LABEL_0">add line breaks to text layer</field><field name="FIELD_TYPE_0">LABEL</field><field name="FIELD_LABEL_1">max chars per line</field><field name="FIELD_TYPE_1">NUMBER_INT</field><field name="FIELD_VAR_1" id="-@|Pb/jEFU.r4Z^]O0@t">max chars per line</field><next><block type="ae_layer_for_all" id="5fZfQ%dpWlNQg^U,i/8D"><field name="SELECTION">SELECTED</field><field name="TYPE">TextLayer</field><field name="LAYER_VAR" id="FR_=*$GQ8*6N|bA#h+uj">my layer</field><field name="COMP_CHOICE">COMP</field><value name="COMP"><shadow type="ae_active_comp" id="s4J],eS{f.0U1RXRg!wK"></shadow></value><statement name="LOOP_STATEMENT"><block type="ae_property_set_attribute" id="GX+ui[km$J9`l^wVtj~|"><field name="PARAM">EXPRESSION</field><value name="ITEM"><block type="ae_property_path" id="fiB*DBB_z5|)+e_/fb=^"><mutation fullPath="Comp 1::Foo/ADBE Text Properties/ADBE Text Document" base="BASE_LAYER"></mutation><field name="PROPERTY_PATH">ADBE Text Properties/ADBE Text Document</field><field name="BASE_DROPDOWN">BASE_LAYER</field><value name="INP_LAYER"><shadow xmlns="" type="text"><field name="TEXT">Comp 1::Foo</field></shadow><block type="variables_get" id="l?Tm%4/SPaGnLXe0uNUD"><field name="VAR" id="FR_=*$GQ8*6N|bA#h+uj">my layer</field></block></value></block></value><value name="VALUE"><shadow type="text_multiline" id="1jqFEUK`Hk8}Et(LmTaB"><field name="TEXT">var maxWidth = $1;&amp;#10;var maxHeight = $2;&amp;#10;var measureAtTime = $3;&amp;#10;var rect = sourceRectAtTime(measureAtTime)&amp;#10;var scaleFactor = Math.min(1,maxWidth/rect.width, maxHeight/rect.height);&amp;#10;value * scaleFactor</field></shadow><block type="string_pattern" id="WiLW!Ci32lz^`]FURnfx"><mutation items="1"></mutation><value name="VALUE"><shadow type="text" id="{!nmYQ`._MP^l23hJwk:"><field name="TEXT">Mr. $1 is $2 years old</field></shadow><block type="text_multiline" id="q%4p1y6Ea~56b=|~jCw_"><field name="TEXT">// define maximum characters per line&amp;#10;var maxCharsPerLine = $1;&amp;#10;&amp;#10;// read the original text as a simple string&amp;#10;var orig = value;&amp;#10;var origLines = orig.split("\r");&amp;#10;&amp;#10;// helper function: wrap a single line into an array of sub‐lines&amp;#10;function wrapLine(str) {&amp;#10;    // if the line is empty, return a single empty string so the blank line is preserved&amp;#10;    if (str.length === 0) {&amp;#10;        return [""];&amp;#10;    }&amp;#10;    &amp;#10;    var words = str.split(" ");&amp;#10;    var lines = [];&amp;#10;    var curLine = "";&amp;#10;    &amp;#10;    for (var i = 0; i &lt; words.length; i++) {&amp;#10;        var w = words[i];&amp;#10;        &amp;#10;        // if adding this word (plus a space if needed) stays within limit&amp;#10;        if (curLine.length + w.length + (curLine.length &gt; 0 ? 1 : 0) &lt;= maxCharsPerLine) {&amp;#10;            if (curLine.length === 0) {&amp;#10;                curLine = w;&amp;#10;            } else {&amp;#10;                curLine = curLine + " " + w;&amp;#10;            }&amp;#10;        } else {&amp;#10;            // this word would overflow the limit&amp;#10;            if (w.length &gt; maxCharsPerLine) {&amp;#10;                // push any existing curLine first&amp;#10;                if (curLine.length &gt; 0) {&amp;#10;                    lines.push(curLine);&amp;#10;                    curLine = "";&amp;#10;                }&amp;#10;                // split the long word into max‐length chunks&amp;#10;                for (var j = 0; j &lt; w.length; j += maxCharsPerLine) {&amp;#10;                    lines.push(w.substr(j, maxCharsPerLine));&amp;#10;                }&amp;#10;            } else {&amp;#10;                // normal case: push current line, start a new one with this word&amp;#10;                lines.push(curLine);&amp;#10;                curLine = w;&amp;#10;            }&amp;#10;        }&amp;#10;    }&amp;#10;    &amp;#10;    // push any leftover text in curLine&amp;#10;    if (curLine.length &gt; 0) {&amp;#10;        lines.push(curLine);&amp;#10;    }&amp;#10;    &amp;#10;    return lines;&amp;#10;}&amp;#10;&amp;#10;// process each original line separately, preserving blank lines&amp;#10;var wrappedLines = [];&amp;#10;for (var i = 0; i &lt; origLines.length; i++) {&amp;#10;    var subWrapped = wrapLine(origLines[i]);&amp;#10;    for (var k = 0; k &lt; subWrapped.length; k++) {&amp;#10;        wrappedLines.push(subWrapped[k]);&amp;#10;    }&amp;#10;}&amp;#10;&amp;#10;// join all wrapped lines with "\r" so AE respects them as line breaks&amp;#10;wrappedLines.join("\r");&amp;#10;&amp;#10;&amp;#10;&amp;#10;</field></block></value><value name="ADD0"><shadow type="text" id="Uj#!i8e{De$D+}Btb:z0"><field name="TEXT">Miller</field></shadow><block type="variables_get" id="nWt;hlj7-xik]S5]ot|{"><field name="VAR" id="-@|Pb/jEFU.r4Z^]O0@t">max chars per line</field></block></value></block></value></block></statement></block></next></block></next></block></xml>